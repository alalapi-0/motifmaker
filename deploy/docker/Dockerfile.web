# ==========================================
# MotifMaker 前端镜像构建文件
# 使用多阶段构建：阶段一使用 node:18-alpine 构建静态资源，阶段二使用 nginx:alpine 提供静态服务。
# 注意：仓库不提交 web/dist 产物，镜像应由 CI/CD 构建并推送。
# ==========================================

FROM node:18-alpine AS builder
WORKDIR /app

# 复制 package.json 和锁定文件，保持依赖一致。
COPY web/package.json web/package-lock.json ./
RUN npm ci

# 复制前端源代码并构建。
COPY web/ ./
RUN npm run build

# 运行阶段：使用 Nginx 提供静态资源。
FROM nginx:alpine AS runtime

# 拷贝自定义 Nginx 配置（如需），此处使用默认即可。
# COPY deploy/docker/nginx.conf /etc/nginx/conf.d/default.conf

# 将构建出的静态文件放入默认站点目录。
COPY --from=builder /app/dist/ /usr/share/nginx/html/

# 暴露端口 80，容器启动后可直接访问静态页面。
EXPOSE 80

# 使用默认的 nginx 启动命令。
CMD ["nginx", "-g", "daemon off;"]
